<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Chat Backend • Dashboard</title>
    <meta name="color-scheme" content="dark light">
    <style>
      :root {
        --bg: #0b1020;
        --panel: #10192b;
        --muted: #9aa4b2;
        --text: #e6e9ef;
        --accent: #7c5cff;
        --accent-2: #4fd1c5;
        --green: #22c55e;
        --red: #ef4444;
        --yellow: #f59e0b;
        --card: rgba(255,255,255,0.04);
        --card-border: rgba(255,255,255,0.08);
      }
      * { box-sizing: border-box; }
      html, body { height: 100%; }
      body {
        margin: 0;
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji";
        color: var(--text);
        background:
          radial-gradient(1200px 600px at 10% -10%, #1b1255, transparent 60%),
          radial-gradient(900px 500px at 110% 10%, #0f3b48, transparent 40%),
          linear-gradient(180deg, #0a0f1f 0%, #0b1020 100%);
      }
      .wrap { max-width: 1100px; margin: 0 auto; padding: 40px 20px 80px; }
      header {
        display: grid; gap: 12px; justify-items: start; margin-bottom: 28px;
      }
      .badge { color: #cbd5e1; background: #0f172a; border: 1px solid var(--card-border); padding: 6px 10px; border-radius: 999px; font-size: 12px; letter-spacing: .4px; }
      h1 { margin: 0; font-size: 34px; letter-spacing: .3px; }
      p.lead { margin: 0; color: var(--muted); }

      .grid { display: grid; gap: 16px; grid-template-columns: repeat(12, 1fr); }
      .col-4 { grid-column: span 4; }
      .col-6 { grid-column: span 6; }
      .col-8 { grid-column: span 8; }
      .col-12 { grid-column: span 12; }
      @media (max-width: 900px) { .col-4, .col-6, .col-8 { grid-column: span 12; } }

      .card {
        background: var(--card);
        border: 1px solid var(--card-border);
        border-radius: 14px;
        padding: 18px;
        backdrop-filter: blur(4px);
      }
      .card h3 { margin: 0 0 8px; font-size: 16px; font-weight: 600; letter-spacing: .2px; }
      .muted { color: var(--muted); }
      .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace; }

      .kpi { display: flex; align-items: center; gap: 12px; }
      .dot { width: 10px; height: 10px; border-radius: 50%; display: inline-block; }
      .dot.ok { background: var(--green); box-shadow: 0 0 12px rgba(34,197,94,.5); }
      .dot.bad { background: var(--red); box-shadow: 0 0 12px rgba(239,68,68,.5); }

      .endpoints { display: grid; gap: 8px; }
      .endpoint { display: grid; grid-template-columns: 90px 1fr auto; gap: 10px; align-items: center; padding: 10px 12px; border: 1px dashed var(--card-border); border-radius: 10px; }
      .ep-method { font-weight: 700; font-size: 12px; letter-spacing: .6px; text-align: center; padding: 6px 8px; border-radius: 999px; }
      .GET { color: #10b981; background: rgba(16,185,129,.1); border: 1px solid rgba(16,185,129,.25); }
      .POST { color: #60a5fa; background: rgba(96,165,250,.12); border: 1px solid rgba(96,165,250,.25); }
      .auth { color: #eab308; }
      .copy { color: var(--muted); cursor: pointer; padding: 6px 8px; border-radius: 8px; border: 1px solid transparent; }
      .copy:hover { border-color: var(--card-border); color: #cbd5e1; background: rgba(255,255,255,.03); }

      footer { margin-top: 28px; color: var(--muted); font-size: 12px; display: flex; gap: 12px; align-items: center; }
      .pill { border: 1px solid var(--card-border); border-radius: 999px; padding: 6px 10px; }
      .accent { color: var(--accent-2); }
      .link { color: var(--accent); text-decoration: none; }
    </style>
  </head>
  <body>
    <div class="wrap">
      <header>
        <span class="badge">Chat • Backend</span>
        <h1>Panel del Servicio</h1>
        <p class="lead">Estado en tiempo real, rutas API y detalles rápidos del servicio.</p>
      </header>

      <section class="grid">
        <div class="col-4 card">
          <h3>Estado</h3>
          <div class="kpi">
            <span id="statusDot" class="dot bad"></span>
            <div>
              <div id="statusText">Desconectado</div>
              <div class="muted" id="statusTime">—</div>
            </div>
          </div>
        </div>
        <div class="col-4 card">
          <h3>Base URL</h3>
          <div class="mono" id="baseUrl">—</div>
          <div class="muted">Usada por los clientes web y móviles.</div>
        </div>
        <div class="col-4 card">
          <h3>WebSocket</h3>
          <div class="mono">socket.io</div>
          <div class="muted">Autenticación por <span class="mono">Bearer JWT</span> en <span class="mono">handshake</span>.</div>
        </div>

        <div class="col-8 card">
          <h3>Rutas API</h3>
          <div class="endpoints">
            <div class="endpoint">
              <div class="ep-method GET">GET</div>
              <div class="mono">/health</div>
              <button class="copy" data-path="/health">Copiar</button>
            </div>
            <div class="endpoint">
              <div class="ep-method POST">POST</div>
              <div class="mono">/api/auth/register</div>
              <button class="copy" data-path="/api/auth/register">Copiar</button>
            </div>
            <div class="endpoint">
              <div class="ep-method POST">POST</div>
              <div class="mono">/api/auth/login</div>
              <button class="copy" data-path="/api/auth/login">Copiar</button>
            </div>
            <div class="endpoint">
              <div class="ep-method GET">GET</div>
              <div class="mono">/api/chat/rooms/:roomId/messages</div>
              <button class="copy" data-path="/api/chat/rooms/:roomId/messages">Copiar</button>
            </div>
            <div class="endpoint">
              <div class="ep-method POST">POST</div>
              <div class="mono">/api/uploads/image</div>
              <button class="copy" data-path="/api/uploads/image">Copiar</button>
            </div>
          </div>
        </div>

        <div class="col-4 card">
          <h3>Consejos rápidos</h3>
          <ul style="margin: 8px 0 0 18px; padding: 0; color: var(--muted); line-height: 1.7;">
            <li>Añade <span class="mono">Authorization: Bearer &lt;JWT&gt;</span> a rutas protegidas.</li>
            <li>El límite JSON es de <span class="mono">2mb</span>.</li>
            <li>CORS configurado desde <span class="mono">CORS_ORIGIN</span>.</li>
          </ul>
        </div>
      </section>

      <footer>
        <span class="pill">Express 5</span>
        <span class="pill">Helmet</span>
        <span class="pill">Socket.IO</span>
        <span class="pill">Postgres + Mongo</span>
        <span style="margin-left:auto;">Hecho con <span class="accent">❤</span> para un backend bonito</span>
      </footer>
    </div>

    <script>
      const byId = (id) => document.getElementById(id);
      const base = window.location.origin;
      byId('baseUrl').textContent = base;

      function setStatus(ok, time) {
        const dot = byId('statusDot');
        const txt = byId('statusText');
        const t = byId('statusTime');
        if (ok) {
          dot.classList.remove('bad');
          dot.classList.add('ok');
          txt.textContent = 'En línea';
          t.textContent = new Date(time).toLocaleString();
        } else {
          dot.classList.remove('ok');
          dot.classList.add('bad');
          txt.textContent = 'Desconectado';
          t.textContent = '—';
        }
      }

      async function refreshHealth() {
        try {
          const r = await fetch(base + '/health', { cache: 'no-store' });
          const j = await r.json();
          setStatus(!!j.ok, j.time);
        } catch (e) {
          setStatus(false);
        }
      }

      // Copy buttons
      for (const btn of document.querySelectorAll('.copy')) {
        btn.addEventListener('click', async () => {
          const path = btn.dataset.path;
          const text = base + path;
          try {
            await navigator.clipboard.writeText(text);
            btn.textContent = 'Copiado ✓';
            setTimeout(() => (btn.textContent = 'Copiar'), 1200);
          } catch {
            btn.textContent = 'Error';
            setTimeout(() => (btn.textContent = 'Copiar'), 1200);
          }
        });
      }

      refreshHealth();
      setInterval(refreshHealth, 6000);
    </script>
  </body>
</html>
